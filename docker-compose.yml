version: '3.8'

services:
  backend:
    image: cshub-backend:latest
    build:
      context: ./backend
      dockerfile: Dockerfile.backend
    container_name: cshub-backend
    ports:
      - "9037:9037"
    environment:
      - PLAY_SECRET_KEY=changeme-secret-key-change-in-production-please-update
    # Override database connection to use host.docker.internal for MySQL on host
    command: >
      /app/basicframework-1.0-SNAPSHOT/bin/basicframework
      -Dplay.http.secret.key=changeme-secret-key-change-in-production-please-update
      -Dhttp.port=9037
      -Dhttp.address=0.0.0.0
      -Dplay.filters.disabled.0=play.filters.hosts.AllowedHostsFilter
      -Ddb.default.url=jdbc:mysql://host.docker.internal:3306/cshub?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
      -Ddb.default.username=root
      -Ddb.default.password=pw5330
      -Dplay.evolutions.enabled=false
    extra_hosts:
      - "host.docker.internal:host-gateway"
    restart: unless-stopped

  frontend:
    image: cshub-frontend:latest
    build:
      context: ./frontend
      dockerfile: Dockerfile.frontend
    container_name: cshub-frontend
    ports:
      - "9036:9036"
    environment:
      - PLAY_SECRET_KEY=changeme-secret-key-change-in-production-please-update
      - BACKEND_URL=http://backend:9037
    # Override backend URL to point to backend container
    command: >
      /app/basicframework-1.6.1-SNAPSHOT/bin/basicframework
      -Dplay.http.secret.key=changeme-secret-key-change-in-production-please-update
      -Dhttp.port=9036
      -Dhttp.address=0.0.0.0
      -Dsystem.backend.url=http://backend:9037
      -Dsystem.backend.rest-protocol=http
      -Dsystem.backend.rest-host=backend
      -Dsystem.backend.rest-port=9037
    depends_on:
      - backend
    restart: unless-stopped

