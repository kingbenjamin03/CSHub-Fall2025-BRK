@import java.util
@(entries: util.List[Organization],
        isPrivateZone: Boolean,
        isCallerMySpacePage: Boolean,
        pageNum: Integer,
        sort: String,
        offset: Integer,
        total: Integer,
        count: Integer,
        listType: String,
        pageLimit: Integer,
        searchBody: String,
        organizationName: String,
        id: Long, beginIndexForPagination: Integer, endIndexForPagination: Integer)
@import helper._


@scripts = {
    <script type = "module" src='@routes.Assets.at("javascripts/voiceJump.js")'></script>
    <link rel="stylesheet" href="/assets/stylesheets/responsive-table.css">

    <script type="text/javascript">
            $(document).ready(function () {
                var nasaEndorsedAPIArray = []
                @for(i <- 0 until entries.size) {
                var json = {};
                json.id = '@entries.get(i).getId()';
                json.url = "/organization/organizationDetailPage/" + json.id;

                json.name = '@entries.get(i).getOrganizationName()'.replace(/[^a-zA-Z0-9]/g, " ").replace(/  +/g, " ").trim();
                console.log("jsonhere:" + json)
                nasaEndorsedAPIArray.push(json)
                }
                $("#nasaText").text(JSON.stringify(nasaEndorsedAPIArray));

                $('.tooltipped').tooltip();

                // $("#speak-from-filter").click();
                // $("#speak-nasa").click();
                // $("#speak-from-filter").click();

            });

            function jumpToPage(pageNum, sort, searchString) {
                pageNum = Math.floor(pageNum);
                var url = "/organization/searchPOST?pageNum=" + (pageNum) + "&sortCriteria=" + sort;
                var form = $(document.createElement('form'));
                $(form).attr("action", url);
                $(form).attr("method", "POST");
                $(form).css("display", "none");


                var form_searchString = $("<input>")
                        .attr("type", "text")
                        .attr("name", "searchString")
                        .val(searchString);
                $(form).append($(form_searchString));

                form.appendTo(document.body);
                $(form).submit();
            }


            @***** Change project viewpoint, refreshing the screen *******@

            function changeView(view) {
                $.ajax({
                    url: "/updateProjectZone/" + view,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    type: "GET"
                }).done(function (data) {
                    window.location.href = "/organization/organizationListPage/1?sortCriteria=id";
                });
            }
    </script>
    <style>
            .follow-fab {
                top: -20px !important;
                bottom: auto !important;
                right: -20px !important;
            }

            .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .truncate-multiline {
                display: -webkit-box;
                -webkit-line-clamp: 3;
                -webkit-box-orient: vertical;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: normal;
            }

    </style>
}

@main("All Organizations", scripts) {
    <div class="container">
        <div class="row">
            <div class="col s12 m12">
                <div class="card-panel center">
                    @if(isCallerMySpacePage) {
                        <div class="row card-panel z-depth-0 project-zone-panel">
                            <div class="col s12" style="margin-top: -10px;
                                margin-bottom: -10px;">
                                <h6 class="left tooltipped" data-position="bottom" data-tooltip="This list shows all the APIs associated with your current project zone." >
                                    Current Project Zone :
                                    @if(isPrivateZone) {
                                        Your Private Zone
                                    } else {
                                        OpenNEX
                                }
                                </h6>

                                <a class='dropdown-trigger right' href='#' data-target='dropdown1' style="text-transform: none;
                                    font-weight: bold;
                                    color: white;
                                    padding-top: 8px;
                                    font-family: AmazonEmberBold, Helvetica Neue Bold, Helvetica Neue, Helvetica, Arial, sans-serif;
                                !important;"><font style="weight: bold;"> <u>
                                    Change Project Zone </u></font><i class="material-icons right">expand_more</i>
                                </a>
                                    <!-- Dropdown Structure -->
                                <ul id='dropdown1' class='dropdown-content'>
                                    <li style="font-family: AmazonEmberLight, Helvetica Neue Bold, Helvetica Neue, Helvetica, Arial, sans-serif;
                                    !important;"><a href="#!" onclick="changeView('normal')"><i class="material-icons">
                                        view_module </i>
                                        OpenNEX project zone</a></li>
                                    <li style="font-family: AmazonEmberLight, Helvetica Neue Bold, Helvetica Neue, Helvetica, Arial, sans-serif;
                                    !important;"><a href="#!" onclick="changeView('private')"><i class="material-icons">
                                        security</i>
                                        Your private zone</a></li>
                                </ul>
                            </div>
                        </div>
                    }

                    @if(entries.size() > 0) {
                        <div class="col s8 offset-s2">
                            <h4>Organization List</h4>

                        </div>
                        <div class="col s2">
                            <button id = "speak-from-filter" hidden></button>

                            <div id="nasaText" hidden></div>
                            <div id="requestField"></div>
                            <div id="replyField"></div>
                        </div>
                        <div class="row">
                            <div class="col s6">
                                <h6 class="left">Showing results: @{
                                    offset + 1
                                } to @{
                                    offset + count
                                } of @total</h6>
                            </div>
                            <div class="col s6" style="padding-top: -5px;
                                margin-top: -2px">
                                <a class='dropdown-trigger btn-flat right' href='#' data-target='dropdown2' style="text-transform: none;
                                    font-weight: bold;
                                    color: black;
                                    font-family: AmazonEmberBold, Helvetica Neue Bold, Helvetica Neue, Helvetica, Arial, sans-serif;
                                !important; ">
                                    Sort By: &nbsp; <font color="#3a5dc3">
                                @if(sort.equals("id")) {
                                    ID
                                } else if(sort.equals("organization_name")) {
                                    Organization Name
                                } else if(sort.equals("address")) {
                                    Address
                                } else if(sort.equals("focuses")) {
                                    Focuses
                                } else if(sort.equals("url")) {
                                    Url
                                } else {
                                    Organization Name
                                }</font> <i class="material-icons right">expand_more</i></a>

                                    <!-- Dropdown Structure -->
                                <ul id='dropdown2' class='dropdown-content'>
                                @if(listType.equals("all")) {
                                    <li><a href="@routes.OrganizationController.organizationListPage(1, "id")" class="grey-text text-darken-4"><i class="material-icons">
                                        event</i>ID</a></li>
                                    <li><a href="@routes.OrganizationController.organizationListPage(1, "organization_name")" class="grey-text text-darken-4"><i class="material-icons">
                                        sort_by_alpha</i>Organization Name </a></li>
                                    <li><a href="@routes.OrganizationController.organizationListPage(1, "address")" class="grey-text text-darken-4"><i class="material-icons">
                                        sort_by_alpha</i>Address</a></li>
                                    <li><a href="@routes.OrganizationController.organizationListPage(1, "focuses")" class="grey-text text-darken-4"><i class="material-icons">
                                        sort_by_alpha</i>Focuses</a></li>
                                    <li><a href="@routes.OrganizationController.organizationListPage(1, "url")" class="grey-text text-darken-4"><i class="material-icons">
                                        sort_by_alpha</i>Url</a></li>
                                } else {
                                    <li>
                                        <a onclick="jumpToPage(1, 'id', '@searchBody')">
                                            <i class="material-icons">event</i>Date Created
                                        </a>
                                    </li>
                                    <li>
                                        <a onclick="jumpToPage(1, 'organization_name', '@searchBody')">
                                            <i class="material-icons">sort_by_alpha</i>Name
                                        </a>
                                    </li>
                                }
                                </ul>
                            </div>
                        </div>

@*                        <div class="table-responsive">*@
@*                        <table class="centered responsive-table striped" id="organizationTable" >*@
@*                            <thead>*@
@*                                <tr class="list-header" style="border-bottom: 1px solid;*@
@*                                !important;">*@
@*                                    <th style="cursor: pointer;">Organization Name</th>*@
@*                                    <th style="cursor: pointer;">Address</th>*@
@*                                    *@@*                                    <th style="cursor: pointer;">Affiliation</th>*@
@*                                    <th style="cursor: pointer;">Focuses</th>*@
@*                                    *@@*                                    <th style="cursor: pointer;">Research Areas</th>*@
@*                                    <th style="cursor: pointer;">URL</th>*@
@*                                </tr>*@
@*                            </thead>*@
@*                            <tbody>*@
@*                            @for((entry, index) <- entries.zipWithIndex) {*@
@*                                <tr>*@
@*                                    <td>*@
@*                                        <a href="@routes.OrganizationController.organizationDetailPage(entry.getId())">*@
@*                                        @entry.getOrganizationName()*@
@*                                        </a>*@
@*                                    </td>*@
@*                                    <td>*@
@*                                        @{*@
@*                                            val parts = Seq(*@
@*                                                Option(entry.getStreetAddress1).map(_.toString).getOrElse(""),*@
@*                                                Option(entry.getStreetAddress2).map(_.toString).getOrElse(""),*@
@*                                                Option(entry.getCity).map(_.toString).getOrElse(""),*@
@*                                                Option(entry.getState).map(_.toString).getOrElse(""),*@
@*                                                Option(entry.getZipCode).map(_.toString).getOrElse("")*@
@*                                            ).filter(s => s.trim.nonEmpty)*@
@*                                            parts.mkString(", ")*@
@*                                        }*@
@*                                    </td>*@
@*                                    <td>*@
@*                                        @{*@
@*                                            val focusText = Option(entry.getFocuses()).getOrElse("")*@
@*                                            val words = focusText.split("\\s+")*@
@*                                            val wordLimit = 30*@
@*                                            val displayText = if (words.length > wordLimit) {*@
@*                                                words.take(wordLimit).mkString(" ") + "..."*@
@*                                            } else {*@
@*                                                focusText*@
@*                                            }*@
@*                                            displayText*@
@*                                        }*@
@*                                    </td>*@
@*                                    <td>*@
@*                                    @if(entry.getURL() != null && entry.getURL().length > 50) {*@
@*                                        @entry.getURL().substring(0, 50) ...*@
@*                                    } else {*@
@*                                        @entry.getURL()*@
@*                                    }*@
@*                                    </td>*@
@*                                </tr>*@
@*                            }*@
@*                            </tbody>*@
@*                        </table>*@
@*                        </div>*@
@*                        <div class="hide-on-small-only">*@
@*                        <div class="table-responsive">*@
@*                            <table class="centered responsive-table striped" id="organizationTable">*@
@*                                <thead>*@
@*                                    <tr class="list-header" style="border-bottom: 1px solid;">*@
@*                                        <th style="cursor: pointer;">Organization Name</th>*@
@*                                        <th style="cursor: pointer;">Address</th>*@
@*                                        <th style="cursor: pointer;">Focuses</th>*@
@*                                        <th style="cursor: pointer;">URL</th>*@
@*                                    </tr>*@
@*                                </thead>*@
@*                                <tbody>*@
@*                                @for((entry, index) <- entries.zipWithIndex) {*@
@*                                    <tr>*@
@*                                        <td data-label="Organization Name">*@
@*                                            <a href="@routes.OrganizationController.organizationDetailPage(entry.getId())">*@
@*                                            @entry.getOrganizationName()*@
@*                                            </a>*@
@*                                        </td>*@
@*                                        <td data-label="Address">*@
@*                                        @{*@
@*                                            val parts = Seq(*@
@*                                                Option(entry.getStreetAddress1).map(_.toString).getOrElse(""),*@
@*                                                Option(entry.getStreetAddress2).map(_.toString).getOrElse(""),*@
@*                                                Option(entry.getCity).map(_.toString).getOrElse(""),*@
@*                                                Option(entry.getState).map(_.toString).getOrElse(""),*@
@*                                                Option(entry.getZipCode).map(_.toString).getOrElse("")*@
@*                                            ).filter(_.trim.nonEmpty)*@
@*                                            parts.mkString(", ")*@
@*                                        }*@
@*                                        </td>*@
@*                                        <td data-label="Focuses">*@
@*                                        @{*@
@*                                            val focusText = Option(entry.getFocuses()).getOrElse("")*@
@*                                            val words = focusText.split("\\s+")*@
@*                                            val wordLimit = 30*@
@*                                            val displayText = if (words.length > wordLimit) {*@
@*                                                words.take(wordLimit).mkString(" ") + "..."*@
@*                                            } else {*@
@*                                                focusText*@
@*                                            }*@
@*                                            displayText*@
@*                                        }*@
@*                                        </td>*@
@*                                        <td data-label="URL">*@
@*                                        @if(entry.getURL() != null && entry.getURL().length > 50) {*@
@*                                            @entry.getURL().substring(0, 50) + "..."*@
@*                                        } else {*@
@*                                            @entry.getURL()*@
@*                                        }*@
@*                                        </td>*@
@*                                    </tr>*@
@*                                }*@
@*                                </tbody>*@
@*                            </table>*@
@*                            <div class="mobile-list hide-on-med-and-up">*@
@*                            @for((entry, index) <- entries.zipWithIndex) {*@
@*                                <div class="card-panel z-depth-1" style="margin-bottom: 12px;">*@
@*                                    <div><strong>Organization Name:</strong>*@
@*                                        <a href="@routes.OrganizationController.organizationDetailPage(entry.getId())">*@
@*                                        @entry.getOrganizationName()*@
@*                                        </a>*@
@*                                    </div>*@
@*                                    <div><strong>Address:</strong>*@

@*                                    </div>*@
@*                                    <div><strong>Focuses:</strong>*@
@*                                        @{*@
@*                                            val focusText = Option(entry.getFocuses()).getOrElse("")*@
@*                                            val words = focusText.split("\\s+")*@
@*                                            val displayText = if (words.length > 30) words.take(30).mkString(" ") + "..." else focusText*@
@*                                            displayText*@
@*                                        }*@
@*                                    </div>*@
@*                                    <div><strong>URL:</strong>*@
@*                                        @if(entry.getURL() != null && entry.getURL().length > 50) {*@
@*                                            @entry.getURL().substring(0, 50) + "..."*@
@*                                        } else {*@
@*                                            @entry.getURL()*@
@*                                        }*@
@*                                    </div>*@
@*                                </div>*@
@*                            }*@
@*                            </div>*@

@*                        </div>*@
@*                        </div>*@

                        <!-- Desktop Table -->
                        <div class="desktop-table-view">
                            <div class="table-responsive">
                                <table class="centered responsive-table striped" id="organizationTable">
                                    <thead>
                                        <tr class="list-header">
                                            <th>ID</th>
                                            <th>Organization Name</th>
                                            <th>Address</th>
                                            <th>Focuses</th>
                                            <th>URL</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    @for((entry, index) <- entries.zipWithIndex) {
                                        <tr>
                                            <td>@entry.getId()</td>
                                            <td><a href="@routes.OrganizationController.organizationDetailPage(entry.getId())">@entry.getOrganizationName()</a></td>
                                            <td>
                                            @{
                                                val parts = Seq(
                                                    Option(entry.getStreetAddress1).map(_.toString).getOrElse(""),
                                                    Option(entry.getStreetAddress2).map(_.toString).getOrElse(""),
                                                    Option(entry.getCity).map(_.toString).getOrElse(""),
                                                    Option(entry.getState).map(_.toString).getOrElse(""),
                                                    Option(entry.getZipCode).map(_.toString).getOrElse("")
                                                ).filter(_.trim.nonEmpty)
                                                parts.mkString(", ")
                                            }
                                            </td>
@*                                            <td>@{*@
@*                                                val focus = Option(entry.getFocuses).getOrElse("")*@
@*                                                val words = focus.split("\\s+")*@
@*                                                if (words.length > 30) words.take(30).mkString(" ") + "..." else focus*@
@*                                            }</td>*@
                                            <td>
                                                @defining(Option(entry.getFocuses).getOrElse("")) { focusText =>
                                                    <span class="tooltipped truncate-multiline"
                                                    data-position="bottom"
                                                    data-tooltip="@focusText">
                                                    @focusText
                                                    </span>
                                                }
                                            </td>
                                            <td>@if(entry.getURL != null && entry.getURL.length > 50) { @entry.getURL.substring(0, 50) + "..." } else { @entry.getURL }</td>
                                        </tr>
                                    }
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Mobile Cards -->
                        <div class="mobile-table-view">
                        @for(entry <- entries.asScala) {
                            <div class="card-panel z-depth-1" style="margin-bottom: 16px;">
                                <div><h6>ID:</h6> @entry.getId()</div>
                                <div><h6>Organization Name:</h6> <a href="@routes.OrganizationController.organizationDetailPage(entry.getId())">@entry.getOrganizationName()</a></div>
                                <div><h6>Address:</h6>
                                    @{
                                        val parts = Seq(
                                            Option(entry.getStreetAddress1).map(_.toString).getOrElse(""),
                                            Option(entry.getStreetAddress2).map(_.toString).getOrElse(""),
                                            Option(entry.getCity).map(_.toString).getOrElse(""),
                                            Option(entry.getState).map(_.toString).getOrElse(""),
                                            Option(entry.getZipCode).map(_.toString).getOrElse("")
                                        ).filter(_.trim.nonEmpty)
                                        parts.mkString(", ")
                                    }
                                </div>
                                <div><h6>Focuses:</h6> @{
                                    val focus = Option(entry.getFocuses).getOrElse("")
                                    val words = focus.split("\\s+")
                                    if (words.length > 30) words.take(30).mkString(" ") + "..." else focus
                                }</div>
                                <div><h6>URL:</h6> @if(entry.getURL != null && entry.getURL.length > 50) { @entry.getURL.substring(0, 50) + "..." } else { @entry.getURL }</div>
                            </div>
                        }
                        </div>

                        <div class="row">
                            <div class="col s12">
                                <ul class="pagination center-align">

                                @if(listType.equals("all")) {
                                    @if(pageNum == 1) {
                                        <li class="waves-effect disabled" style="color: #c3bfbf;"><i class="material-icons">
                                            first_page</i></li>
                                        <li class="waves-effect disabled" style="color: #c3bfbf;"><i class="material-icons">
                                            chevron_left</i></li>
                                    } else {
                                        <li class="waves-effect"><a href="@routes.OrganizationController.organizationListPage(1, sort)"><i class="material-icons">
                                            first_page</i></a></li>
                                        <li class="waves-effect"><a href="@routes.OrganizationController.organizationListPage(pageNum - 1, sort)"><i class="material-icons">
                                            chevron_left</i></a></li>
                                    }
                                    @if(beginIndexForPagination > 1) {
                                        <li class="waves-effect modal-trigger" href="#allPageModal" style="cursor: pointer;
                                            font-size: 20px;
                                            font-weight: bold">...</li>
                                    }
                                    @for(i <- (beginIndexForPagination + 0) to (endIndexForPagination + 0)) {
                                        <li @if(pageNum == i) {
                                            class="active"}><a href="@routes.OrganizationController.organizationListPage(i, sort)">@i</a></li>
                                    }
                                    @if(endIndexForPagination < ((total - 1) / pageLimit + 1)) {
                                        <li class="waves-effect modal-trigger" href="#allPageModal" style="cursor: pointer;
                                            font-size: 20px;
                                            font-weight: bold">...</li>
                                    }
                                    @if((offset + count) >= total) {
                                        <li class="waves-effect disabled" style="color: #c3bfbf;"><i class="material-icons">
                                            chevron_right</i></li>
                                        <li class="waves-effect disabled" style="color: #c3bfbf;"><i class="material-icons">
                                            last_page</i></li>
                                    } else {
                                        <li class="waves-effect"><a href="@routes.OrganizationController.organizationListPage(pageNum + 1, sort)"><i class="material-icons">
                                            chevron_right</i></a></li>
                                        <li class="waves-effect"><a href="@routes.OrganizationController.organizationListPage((total - 1) / pageLimit + 1, sort)"><i class="material-icons">
                                            last_page</i></a></li>
                                    }
                                } else {
                                    @if(pageNum == 1) {
                                        <li class="waves-effect disabled" style="color: #c3bfbf;"><i class="material-icons">
                                            first_page</i></li>
                                        <li class="waves-effect disabled" style="color: #c3bfbf;"><i class="material-icons">
                                            chevron_left</i></li>
                                    } else {
                                        <li class="waves-effect">
                                            <a href="#!" onclick="jumpToPage(1, '@sort', '@searchBody')">
                                                <i class="material-icons">first_page</i>
                                            </a>
                                        </li>
                                        <li class="waves-effect">
                                            <a href="#!" onclick="jumpToPage(@pageNum-1, '@sort', '@searchBody')">
                                                <i class="material-icons">chevron_left</i>
                                            </a>
                                        </li>
                                    }
                                    @if(beginIndexForPagination > 1) {
                                        <li class="waves-effect modal-trigger" href="#searchPageModal" style="cursor: pointer;
                                            font-size: 20px;
                                            font-weight: bold">...</li>
                                    }
                                    @for(i <- (beginIndexForPagination + 0) to (endIndexForPagination + 0)) {
                                        <li @if(pageNum == i) {
                                            class="active"}>
                                            <a href="#!" onclick="jumpToPage(@i, '@sort', '@searchBody')">
                                            @i
                                            </a>
                                        </li>
                                    }
                                    @if(endIndexForPagination < ((total - 1) / pageLimit + 1)) {
                                        <li class="waves-effect modal-trigger" href="#searchPageModal" style="cursor: pointer;
                                            font-size: 20px;
                                            font-weight: bold">...</li>
                                    }
                                    @if((offset + count) >= total) {
                                        <li class="waves-effect disabled" style="color: #c3bfbf;"><i class="material-icons">
                                            chevron_right</i></li>
                                        <li class="waves-effect disabled" style="color: #c3bfbf;"><i class="material-icons">
                                            last_page</i></li>
                                    } else {
                                        <li class="waves-effect">
                                            <a href="#!" onclick="jumpToPage(@pageNum+1, '@sort', '@searchBody')">
                                                <i class="material-icons">chevron_right</i>
                                            </a>
                                        </li>
                                        <li class="waves-effect">
                                            <a href="#!" onclick="jumpToPage((@total-1) / (@pageLimit) + 1, '@sort', '@searchBody')">
                                                <i class="material-icons">last_page</i>
                                            </a>
                                        </li>
                                    }
                                }
                                </ul>
                            </div>
                        </div>
                    } else {
                        <h5>No organization was found.</h5>
                    }

                    <div id="allPageModal" class="modal">
                        <div class="modal-content">
                            <h6>Select the page number you want to jump to</h6>
                            <div class="card z-depth-0">

                            @for(i <- (0) to ((((total - 1) / (pageLimit) + 1) - 1) / 10)) {
                                <ul class="pagination center-align">
                                @for(j <- (i * 10 + 1) to (i * 10 + 10)) {
                                    @if(j <= ((total - 1) / (pageLimit) + 1)) {
                                        @if(j != pageNum) {
                                            <li class="waves-effect grey lighten-3"><a href='@routes.OrganizationController.organizationListPage(j, sort)'>@j</a></li>
                                        } else {
                                            <li class="waves-effect active"><a href="@routes.OrganizationController.organizationListPage(j, sort)">@j</a></li>
                                        }
                                    }
                                }
                                </ul>
                            }
                            </div>
                        </div>
                        <div class="modal-footer">
                            <a href="#!" class="modal-close waves-effect waves-green btn-flat">
                                Cancel</a>
                        </div>
                    </div>

                    <div id="searchPageModal" class="modal">
                        <div class="modal-content">
                            <h6>Select the page number you want to jump to</h6>
                            <div class="card z-depth-0">

                            @for(i <- (0) to ((((total - 1) / (pageLimit) + 1) - 1) / 10)) {
                                <ul class="pagination center-align">
                                @for(j <- (i * 10 + 1) to (i * 10 + 10)) {
                                    @if(j <= ((total - 1) / (pageLimit) + 1)) {
                                        @if(j != pageNum) {
                                            <li class="waves-effect grey lighten-3"><a href='#!' onclick="jumpToPage(@j, 'id', '@searchBody')">@j</a></li>
                                        } else {
                                            <li class="waves-effect active"><a href="#!" onclick="jumpToPage(@j, 'id', '@searchBody')">@j</a></li>
                                        }
                                    }
                                }
                                </ul>
                            }
                            </div>
                        </div>
                        <div class="modal-footer">
                            <a href="#!" class="modal-close waves-effect waves-green btn-flat">
                                Cancel</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}

