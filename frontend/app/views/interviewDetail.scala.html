@(interview: RAInterview, currentUserId: Long, isOwner: Boolean, isApplicant: Boolean)
@import helper._

@scripts = {
    <style>
        .interview-info {
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        .status-badge {
            padding: 5px 10px;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            display: inline-block;
        }
        .status-pending { background-color: #ff9800; }
        .status-confirmed { background-color: #4CAF50; }
        .status-rescheduled { background-color: #2196F3; }
        .status-canceled { background-color: #f44336; }
        .status-declined { background-color: #9e9e9e; }
    </style>
    <script type="text/javascript">
        $(document).ready(function() {
            $('.modal').modal();
        });

        function confirmCancel() {
            var reason = $("#cancelReason").val();
            if (confirm("Are you sure you want to cancel this interview?")) {
                $("#cancelForm").submit();
            }
        }
    </script>
}

@main("Interview Details") {
    <div class="container">
        <div class="row">
            <div class="col s12 m10 offset-m1">
                <div class="card-panel">
                    <h4 class="center">Interview Details</h4>

                    <div class="interview-info">
                        <h5>Interview Information</h5>
                        <table class="striped">
                            <tr>
                                <th>RA Job Position:</th>
                                <td>@interview.getRaJobApplication().getAppliedRAJob().getTitle()</td>
                            </tr>
                            <tr>
                                <th>Applicant:</th>
                                <td>@interview.getApplicant().getFirstName() @interview.getApplicant().getLastName()</td>
                            </tr>
                            <tr>
                                <th>Applicant Email:</th>
                                <td>@interview.getApplicant().getEmail()</td>
                            </tr>
                            <tr>
                                <th>Faculty:</th>
                                <td>@interview.getFaculty().getFirstName() @interview.getFaculty().getLastName()</td>
                            </tr>
                            <tr>
                                <th>Faculty Email:</th>
                                <td>@interview.getFaculty().getEmail()</td>
                            </tr>
                            <tr>
                                <th>Interview Date & Time:</th>
                                <td>@interview.getInterviewTime()</td>
                            </tr>
                            <tr>
                                <th>Status:</th>
                                <td>
                                    @if(interview.getStatus() == "pending") {
                                        <span class="status-badge status-pending">Pending</span>
                                    } else if(interview.getStatus() == "confirmed") {
                                        <span class="status-badge status-confirmed">Confirmed</span>
                                    } else if(interview.getStatus() == "rescheduled") {
                                        <span class="status-badge status-rescheduled">Rescheduled</span>
                                    } else if(interview.getStatus() == "canceled") {
                                        <span class="status-badge status-canceled">Canceled</span>
                                    } else if(interview.getStatus() == "declined") {
                                        <span class="status-badge status-declined">Declined</span>
                                    } else {
                                        <span class="status-badge">@interview.getStatus()</span>
                                    }
                                </td>
                            </tr>
                            @if(interview.getStudentResponse() != null && !interview.getStudentResponse().isEmpty()) {
                                <tr>
                                    <th>Student Response:</th>
                                    <td>
                                        @if(interview.getStudentResponse() == "accepted") {
                                            <span class="green-text">Accepted</span>
                                        } else if(interview.getStudentResponse() == "declined") {
                                            <span class="red-text">Declined</span>
                                        } else if(interview.getStudentResponse() == "reschedule_requested") {
                                            <span class="orange-text">Reschedule Requested</span>
                                        } else {
                                            @interview.getStudentResponse()
                                        }
                                    </td>
                                </tr>
                            }
                            @if(interview.getLocation() != null && !interview.getLocation().isEmpty()) {
                                <tr>
                                    <th>Location:</th>
                                    <td>@interview.getLocation()</td>
                                </tr>
                            }
                            @if(interview.getMeetingLink() != null && !interview.getMeetingLink().isEmpty()) {
                                <tr>
                                    <th>Meeting Link:</th>
                                    <td><a href="@interview.getMeetingLink()" target="_blank">@interview.getMeetingLink()</a></td>
                                </tr>
                            }
                            @if(interview.getNotes() != null && !interview.getNotes().isEmpty()) {
                                <tr>
                                    <th>Notes:</th>
                                    <td>@interview.getNotes()</td>
                                </tr>
                            }
                        </table>
                    </div>

                    <div class="row">
                        <div class="col s12">
                            <h5>Calendar Integration</h5>
                            <a href="/rajob/interview/@interview.getId()/ical" class="btn waves-effect waves-light blue" download>
                                <i class="material-icons left">download</i>Download iCal File
                            </a>
                            <a href="/rajob/interview/@interview.getId()/google-calendar" class="btn waves-effect waves-light red" target="_blank">
                                <i class="material-icons left">event</i>Add to Google Calendar
                            </a>
                            <a href="/rajob/interview/@interview.getId()/outlook-calendar" class="btn waves-effect waves-light blue" target="_blank">
                                <i class="material-icons left">event</i>Add to Outlook Calendar
                            </a>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col s12">
                            @if(isOwner && interview.getStatus() != "canceled" && interview.getStatus() != "declined") {
                                <h5>Faculty Actions</h5>
                                <a href="@routes.RAJobController.rescheduleInterview(interview.getId())" class="btn waves-effect waves-light orange">
                                    <i class="material-icons left">schedule</i>Reschedule Interview
                                </a>
                                <a href="#cancelModal" class="btn waves-effect waves-light red modal-trigger">
                                    <i class="material-icons left">cancel</i>Cancel Interview
                                </a>
                            }
                            
                            @if(isApplicant && interview.getStatus() != "canceled" && interview.getStatus() != "declined" && interview.getStudentResponse() == null) {
                                <h5>Student Actions</h5>
                                <a href="@routes.RAJobController.studentInterviewResponse(interview.getId())" class="btn waves-effect waves-light green">
                                    <i class="material-icons left">check_circle</i>Respond to Interview
                                </a>
                            }
                            
                            @if(isApplicant && interview.getStudentResponse() != null) {
                                <h5>Your Response</h5>
                                <p>
                                    @if(interview.getStudentResponse() == "accepted") {
                                        <span class="green-text">You have accepted this interview.</span>
                                    } else if(interview.getStudentResponse() == "declined") {
                                        <span class="red-text">You have declined this interview.</span>
                                    } else if(interview.getStudentResponse() == "reschedule_requested") {
                                        <span class="orange-text">You have requested to reschedule this interview.</span>
                                    }
                                </p>
                            }
                        </div>
                    </div>

                    <div class="row">
                        <div class="col s12 center">
                            <a href="@routes.RAJobController.rajobApplicationDetail(interview.getRaJobApplication().getId())" class="btn waves-effect waves-light grey">
                                Back to Application
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cancel Interview Modal -->
    @if(isOwner) {
        <div id="cancelModal" class="modal">
            <div class="modal-content">
                <h4>Cancel Interview</h4>
                <p>Are you sure you want to cancel this interview? The applicant will be notified.</p>
                @helper.form(action = routes.RAJobController.cancelInterview(interview.getId()), 'id -> "cancelForm") {
                    @helper.CSRF.formField
                    <div class="row">
                        <div class="input-field col s12">
                            <textarea id="cancelReason" name="reason" class="materialize-textarea"></textarea>
                            <label for="cancelReason">Cancellation Reason (Optional)</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col s12">
                            <button type="submit" class="btn waves-effect waves-light red" onclick="confirmCancel(); return false;">
                                Cancel Interview
                            </button>
                            <a href="#!" class="modal-close btn waves-effect waves-light grey">Close</a>
                        </div>
                    </div>
                }
            </div>
        </div>
    }
}

