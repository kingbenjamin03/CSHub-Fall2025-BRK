@(technologies: List[Technology],
        pageNum: Integer,
        sort: String,
        offset: Integer,
        total: Integer,
        count: Integer,
        listType: String,
        pageLimit: Integer,
        searchBody: String,
        id: Long, beginIndexForPagination: Integer, endIndexForPagination: Integer)
@import helper._;
@import models._
@import models.Technology

@scripts = {
    <script type = "module" src='@routes.Assets.at("javascripts/voiceJump.js")'></script>
    <link rel="stylesheet" href="/assets/stylesheets/responsive-table.css">
    <script type="text/javascript">

            $(document).ready(function () {
                var technologiesArray = []
                @for(i <- 0 until technologies.size) {
                var json = {};
                json.id = '@technologies.get(i).getId()';
                json.url = "/technology/technologyDetail/" + json.id;

                json.name = '@technologies.get(i).getTechnologyTitle'.replace(/[^a-zA-Z0-9]/g, " ").replace(/  +/g, " ").trim();
                console.log("jsonhere:" + json)
                technologiesArray.push(json)
                }
                $("#nasaText").text(JSON.stringify(technologiesArray));

                $('.tooltipped').tooltip();

                // $("#speak-from-filter").click();
                // $("#speak-nasa").click();
                // $("#speak-from-filter").click();

            });

            function jumpToPage(pageNum, sort, searchString) {

                pageNum =  parseInt(pageNum);

                var url = "/technology/searchPOST?pageNum=" + (pageNum) + "&sortCriteria=" + sort;
                var form = $(document.createElement('form'));
                $(form).attr("action", url);
                $(form).attr("method", "POST");
                $(form).css("display", "none");


                var form_searchString = $("<input>")
                        .attr("type", "text")
                        .attr("name", "searchString")
                        .val(searchString);
                $(form).append($(form_searchString));

                console.log("<<<<<<<searchString" + searchString)
                form.appendTo(document.body);
                $(form).submit();
            }

            function string2Map(str) {

                var map = new Map();
                var splitedString = str.replace(new RegExp("],", 'g'), ";");
                var array = splitedString.split(";");
                for(var i=0; i<array.length; i++){
                    var idAndEventsString = array[i];
                    idAndEventsString = idAndEventsString.replace(/[{}[\]\\]/g, " ");
                    var idAndEvents = idAndEventsString.split("=");
                    var id = idAndEvents[0];
                    var eventsString = idAndEvents[1];
                    var events = eventsString.split(",");
                    console.log("events:" + events + "," + i);

                    var formatedEvents = "";
                    for(var j=0; j<events.length; j++){
                        events[j] = events[j].trim();
                        formatedEvents = formatedEvents + events[j] + ";";
                    }
                    if(formatedEvents.length > 1)
                        map.set(id.trim(), formatedEvents);
                }

                return map;
            }


    </script>
    <style>
            .follow-fab {
                top: -20px !important;
                bottom: auto !important;
                right: -20px !important;
            }

            /*To hide the long text*/

            .truncate-multiline {
                display: -webkit-box;
                -webkit-line-clamp: 3;  /* Limit to 3 lines */
                -webkit-box-orient: vertical;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: normal;
            }

            .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

    </style>
}

@main("All Technologies", scripts) {
    <div class="container">
        <div class="card-panel center">
            @if(listType.equals("search")) {
                <div class="row card-panel z-depth-0 project-zone-panel">
                    <div class="col s12" style="margin-top: -10px;
                        margin-bottom: -10px;">
                        <h6 class="center tooltipped" data-position="bottom" data-tooltip="This list shows the search results." >
                            Search Result
                        </h6>
                    </div>
                </div>
            }else if (listType.equals("all")) {
            <div class="row card-panel z-depth-0 project-zone-panel">
                <div class="col s12" style="margin-top: -10px;
                    margin-bottom: -10px;">
                    <h6 class="center tooltipped" data-position="bottom" data-tooltip="This list shows all the projects." >
                        List of Technologies Registered at SMU-Lyle-Sci-Hub
                    </h6>
                </div>
            </div>
            }

            @if(technologies.size() > 0) {
                <div class="col s8 offset-s2">
                    <h4>Technology List</h4>

                </div>
                <div class="col s2">
                    <button id = "speak-from-filter" hidden></button>
                    <div id="nasaText" hidden></div>
                    <div id="requestField"></div>
                    <div id="replyField"></div>
                </div>
                <div class="row">
                    <div class="col s6">
                        <h6 class="left">Showing results: @{
                            offset + 1
                        } to @{
                            offset + count
                        } of @total</h6>
                    </div>
                    <div class="col s6" style="padding-top: -5px;
                        margin-top: -2px">
                        <a class='dropdown-trigger btn-flat right' href='#' data-target='dropdown2' style="text-transform: none;
                            font-weight: bold;
                            color: black;
                            font-family: AmazonEmberBold, Helvetica Neue Bold, Helvetica Neue, Helvetica, Arial, sans-serif;
                        !important; ">
                            Sort By: &nbsp; <font color="#3a5dc3">
                            @if(sort.equals("id")) {
                                Technology ID
                            }else if(sort.equals("technologyTitle")){
                                Technology Title
                                }else if(sort.equals("access_times")){
                                Popularity
                            }else {
                                Technology Title
                            }</font> <i class="material-icons right">expand_more</i></a>

                            <!-- Dropdown Structure -->
                        <ul id='dropdown2' class='dropdown-content'>
                        @if(listType.equals("all")) {
                            <li><a href="@routes.TechnologyController.technologyList(1, "id")" class="grey-text text-darken-4"><i class="material-icons">
                                event</i>Technology ID</a></li>
                            <li><a href="@routes.TechnologyController.technologyList(1, "technology_title")" class="grey-text text-darken-4"><i class="material-icons">
                                sort_by_alpha</i>Technology Title </a></li>
@*                            <li><a href="@routes.ProjectController.projectList(1, "location")" class="grey-text text-darken-4"><i class="material-icons">*@
@*                                sort_by_alpha</i>Challenge Location </a></li>*@
@*                            <li><a href="@routes.ProjectController.projectList(1, "access_times")" class="grey-text text-darken-4"><i class="material-icons">*@
@*                                sort_by_alpha</i>Popularity </a></li>*@
                        }else {
                            <li>
                                <a onclick="jumpToPage(1, 'id', '@searchBody')">
                                    <i class="material-icons">event</i>Technology ID
                                </a>
                            </li>
                            <li>
                                <a onclick="jumpToPage(1, 'title', '@searchBody')">
                                    <i class="material-icons">sort_by_alpha</i>Technology Title
                                </a>
                            </li>
@*                            <li>*@
@*                                <a onclick="jumpToPage(1, 'location', '@searchBody')">*@
@*                                    <i class="material-icons">sort_by_alpha</i>Project Location*@
@*                                </a>*@
@*                            </li>*@
@*                            <li>*@
@*                                <a onclick="jumpToPage(1, 'access_times', '@searchBody')">*@
@*                                    <i class="material-icons">sort_by_alpha</i>Popularity*@
@*                                </a>*@
@*                            </li>*@
                        }
                        </ul>
                    </div>
                </div>

                <!-- Desktop Table -->
                <div class="desktop-table-view">
                    <div class="table-responsive">
                        <table class="centered responsive-table striped" id="projectTable" >
                            <thead>
                                <tr class="list-header" style="border-bottom: 1px solid;
                                !important;">
                                    <th style="cursor: pointer;">Technology Id</th>
                                    <th style="cursor: pointer;">Title</th>
                                    <th style="cursor: pointer;">Short Description</th>
                                    <th style="cursor: pointer;">Keywords</th>
                                    <th style="cursor: pointer;">Fields</th>
                                </tr>
                            </thead>
                            <tbody>
                            @for((entry, index) <- technologies.zipWithIndex) {
                                <tr>
        @*                            <td><a href = "@routes.TechnologyController.technologyDetail(entry.getId())">@entry.getId()</a></td>*@

        @*                            @if(entry.getTechnologyTitle() != "") {*@
        @*                                <td><span class="@entry.getId() editable" data-name='title'></span>*@
        @*                                    @entry.getTechnologyTitle()*@
        @*                                </td>*@
        @*                            } else {*@
        @*                                <td><span class="@entry.getId() editable" data-name='title'>&ensp; -</span></td>*@
        @*                            }*@

                                    <!-- Technology ID as plain text (no hyperlink) -->
                                    <td>@entry.getId()</td>

                                    <!-- Technology Title with hyperlink -->
                                    @if(entry.getTechnologyTitle() != "") {
                                        <td>
                                            <a href="@routes.TechnologyController.technologyDetail(entry.getId())" class="@entry.getId() editable" data-name='title'>
                                            @entry.getTechnologyTitle()
                                            </a>
                                        </td>
                                    } else {
                                        <td>
                                            <span class="@entry.getId() editable" data-name='title'>&ensp; -</span>
                                        </td>
                                    }

                                    @*                            @if(entry.getShortDescription() != "") {*@
        @*                                <td><span class="@entry.getId() editable" data-name='shortDescription'></span>*@

        @*                                    @entry.getShortDescription()*@
        @*                                </td>*@
        @*                            } else {*@
        @*                                <td><span class="@entry.getId() editable" data-name='title'>&ensp; -</span></td>*@
        @*                            }*@

                                    @if(entry.getShortDescription() != null && entry.getShortDescription().nonEmpty) {
                                        <td>
        @*                                    <span class="short-desc @entry.getId() editable" data-name="shortDescription">*@
        @*                                    @entry.getShortDescription()*@
        @*                                    </span>*@

                                            @defining(Option(entry.getShortDescription).getOrElse("")) { shortDesc =>
                                                <span class="tooltipped truncate-multiline"
                                                data-position="bottom"
                                                data-tooltip="@shortDesc">
                                                @shortDesc
                                                </span>
                                            }

                                        </td>
                                    } else {
                                        <td>
                                            <span class="@entry.getId() editable" data-name="shortDescription">&ensp; -</span>
                                        </td>
                                    }

                                    @if(entry.getKeywords() != "") {
                                        <td><span class="@entry.getId() editable" data-name='keywords'></span>

                                            @entry.getKeywords()
                                        </td>
                                    } else {
                                        <td><span class="@entry.getId() editable" data-name='title'>&ensp; -</span></td>
                                    }


                                    @if(entry.getFields() != "") {
                                        <td><span class="@entry.getId() editable" data-name='fields'></span>

                                            @entry.getFields()
                                        </td>
                                    } else {
                                        <td><span class="@entry.getId() editable" data-name='title'>&ensp; -</span></td>
                                    }

                                </tr>
                            }
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Mobile Cards for Technology List -->
                <div class="mobile-table-view">
                @for(entry <- technologies.asScala) {
                    <div class="card-panel z-depth-1" style="margin-bottom: 16px;">

                            <!-- Technology Title -->
                        <div><h6>Technology Title:</h6>
                            <a href="@routes.TechnologyController.technologyDetail(entry.getId())">@entry.getTechnologyTitle()</a>
                        </div>

                            <!-- Short Description (Truncated if too long) -->
                        <div><h6>Short Description:</h6>
                            @{
                                val shortDesc = Option(entry.getShortDescription).getOrElse("")
                                val words = shortDesc.split("\\s+")
                                if (words.length > 30) words.take(30).mkString(" ") + "..." else shortDesc
                            }
                        </div>

                            <!-- Keywords (Truncated if too long) -->
                        <div><h6>Keywords:</h6>
                            @{
                                val keywords = Option(entry.getKeywords).getOrElse("")
                                if (keywords.length > 50) keywords.take(50) + "..." else keywords
                            }
                        </div>

                            <!-- Fields (Truncated if too long) -->
                        <div><h6>Fields:</h6>
                            @{
                                val fields = Option(entry.getFields).getOrElse("")
                                if (fields.length > 50) fields.take(50) + "..." else fields
                            }
                        </div>
                    </div>
                }
                </div>

                <div class="row">
                    <div class="col s12">
                        <ul class="pagination center-align">

                            @if(listType.equals("all")) {
                                @if(pageNum == 1) {
                                    <li class="waves-effect disabled" style="color: #c3bfbf;"><i class="material-icons">
                                        first_page</i></li>
                                    <li class="waves-effect disabled" style="color: #c3bfbf;"><i class="material-icons">
                                        chevron_left</i></li>
                                } else {
                                    <li class="waves-effect"><a href="@routes.ProjectController.projectList(1, sort)"><i class="material-icons">
                                        first_page</i></a></li>
                                    <li class="waves-effect"><a href="@routes.ProjectController.projectList(pageNum - 1, sort)"><i class="material-icons">
                                        chevron_left</i></a></li>
                                }
                                @if(beginIndexForPagination > 1) {
                                    <li class="waves-effect modal-trigger" href="#allPageModal" style="cursor: pointer;
                                        font-size: 20px;
                                        font-weight: bold">...</li>
                                }
                                @for(i <- (beginIndexForPagination + 0) to (endIndexForPagination + 0)) {
                                    <li @if(pageNum == i) {
                                        class="active"}><a href="@routes.ProjectController.projectList(i, sort)">@i</a></li>
                                }
                                @if(endIndexForPagination < ((total - 1) / pageLimit + 1)) {
                                    <li class="waves-effect modal-trigger" href="#allPageModal" style="cursor: pointer;
                                        font-size: 20px;
                                        font-weight: bold">...</li>
                                }
                                @if((offset + count) >= total) {
                                    <li class="waves-effect disabled" style="color: #c3bfbf;"><i class="material-icons">
                                        chevron_right</i></li>
                                    <li class="waves-effect disabled" style="color: #c3bfbf;"><i class="material-icons">
                                        last_page</i></li>
                                } else {
                                    <li class="waves-effect"><a href="@routes.ProjectController.projectList(pageNum + 1, sort)"><i class="material-icons">
                                        chevron_right</i></a></li>
                                    <li class="waves-effect"><a href="@routes.ProjectController.projectList((total - 1) / pageLimit + 1, sort)"><i class="material-icons">
                                        last_page</i></a></li>
                                }
                            }else if(listType.equals("my enroll")){
                            @if(pageNum == 1) {
                                <li class="waves-effect disabled" style="color: #c3bfbf;"><i class="material-icons">
                                    first_page</i></li>
                                <li class="waves-effect disabled" style="color: #c3bfbf;"><i class="material-icons">
                                    chevron_left</i></li>
                            } else {
                                <li class="waves-effect"><a href="@routes.ProjectController.getMyEnrolledProjects(1, sort)"><i class="material-icons">
                                    first_page</i></a></li>
                                <li class="waves-effect"><a href="@routes.ProjectController.getMyEnrolledProjects(pageNum - 1, sort)"><i class="material-icons">
                                    chevron_left</i></a></li>
                            }
                            @if(beginIndexForPagination > 1) {
                                <li class="waves-effect modal-trigger" href="#enrollPageModal" style="cursor: pointer;
                                    font-size: 20px;
                                    font-weight: bold">...</li>
                            }
                            @for(i <- (beginIndexForPagination + 0) to (endIndexForPagination + 0)) {
                                <li @if(pageNum == i) {
                                    class="active"}><a href="@routes.ProjectController.getMyEnrolledProjects(i, sort)">@i</a></li>
                            }
                            @if(endIndexForPagination < ((total - 1) / pageLimit + 1)) {
                                <li class="waves-effect modal-trigger" href="#enrollPageModal" style="cursor: pointer;
                                    font-size: 20px;
                                    font-weight: bold">...</li>
                            }
                            @if((offset + count) >= total) {
                                <li class="waves-effect disabled" style="color: #c3bfbf;"><i class="material-icons">
                                    chevron_right</i></li>
                                <li class="waves-effect disabled" style="color: #c3bfbf;"><i class="material-icons">
                                    last_page</i></li>
                            } else {
                                <li class="waves-effect"><a href="@routes.ProjectController.getMyEnrolledProjects(pageNum + 1, sort)"><i class="material-icons">
                                    chevron_right</i></a></li>
                                <li class="waves-effect"><a href="@routes.ProjectController.getMyEnrolledProjects((total - 1) / pageLimit + 1, sort)"><i class="material-icons">
                                    last_page</i></a></li>
                            }
                            }else{
                            @if(pageNum == 1) {
                                <li class="waves-effect disabled" style="color: #c3bfbf;"><i class="material-icons">
                                    first_page</i></li>
                                <li class="waves-effect disabled" style="color: #c3bfbf;"><i class="material-icons">
                                    chevron_left</i></li>
                            } else {
                                <li class="waves-effect">
                                    <a href="#!" onclick="jumpToPage(1, '@sort', '@searchBody')">
                                        <i class="material-icons">first_page</i>
                                    </a>
                                </li>
                                <li class="waves-effect">
                                    <a href="#!" onclick="jumpToPage(@pageNum-1, '@sort', '@searchBody')">
                                        <i class="material-icons">chevron_left</i>
                                    </a>
                                </li>
                            }
                            @if(beginIndexForPagination > 1) {
                                <li class="waves-effect modal-trigger" href="#searchPageModal" style="cursor: pointer;
                                    font-size: 20px;
                                    font-weight: bold">...</li>
                            }
                            @for(i <- (beginIndexForPagination + 0) to (endIndexForPagination + 0)) {
                                <li @if(pageNum == i) {
                                    class="active"}>
                                    <a href="#!" onclick="jumpToPage(@i, '@sort', '@searchBody')">
                                    @i
                                    </a>
                                </li>
                            }
                            @if(endIndexForPagination < ((total - 1) / pageLimit + 1)) {
                                <li class="waves-effect modal-trigger" href="#searchPageModal" style="cursor: pointer;
                                    font-size: 20px;
                                    font-weight: bold">...</li>
                            }
                            @if((offset + count) >= total) {
                                <li class="waves-effect disabled" style="color: #c3bfbf;"><i class="material-icons">
                                    chevron_right</i></li>
                                <li class="waves-effect disabled" style="color: #c3bfbf;"><i class="material-icons">
                                    last_page</i></li>
                            } else {
                                <li class="waves-effect">
                                    <a href="#!" onclick="jumpToPage(@pageNum+1, '@sort', '@searchBody')">
                                        <i class="material-icons">chevron_right</i>
                                    </a>
                                </li>
                                <li class="waves-effect">
                                    <a href="#!" onclick="jumpToPage((@total-1)/(@pageLimit)+1, '@sort', '@searchBody')">
                                        <i class="material-icons">last_page</i>
                                    </a>
                                </li>
                            }
                            }
                        </ul>
                    </div>
                </div>
            } else {
                <h5>No technology was found.</h5>
            }
            <div id="allPageModal" class="modal">
                <div class="modal-content">
                    <h6>Select the page number you want to jump to</h6>
                    <div class="card z-depth-0">

                    @for(i <- (0) to ((((total - 1)/(pageLimit) + 1) - 1)/10)) {
                        <ul class="pagination center-align">
                        @for(j <- (i * 10 + 1) to (i * 10 + 10)) {
                            @if(j <= ((total - 1)/(pageLimit) + 1)) {
                                @if(j != pageNum) {
                                    <li class="waves-effect grey lighten-3"><a href='@routes.ProjectController.projectList(j, sort)'>@j</a></li>
                                }else{
                                    <li class="waves-effect active"><a href="@routes.ProjectController.projectList(j, sort)">@j</a></li>
                                }
                            }
                        }
                        </ul>
                    }
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#!" class="modal-close waves-effect waves-green btn-flat">
                        Cancel</a>
                </div>
            </div>

            <div id="enrollPageModal" class="modal">
                <div class="modal-content">
                    <h6>Select the page number you want to jump to</h6>
                    <div class="card z-depth-0">

                    @for(i <- (0) to ((((total - 1)/(pageLimit) + 1) - 1)/10)) {
                        <ul class="pagination center-align">
                        @for(j <- (i * 10 + 1) to (i * 10 + 10)) {
                            @if(j <= ((total - 1)/(pageLimit) + 1)) {
                                @if(j != pageNum) {
                                    <li class="waves-effect grey lighten-3"><a href='@routes.ProjectController.getMyEnrolledProjects(j, sort)'>@j</a></li>
                                }else{
                                    <li class="waves-effect active"><a href="@routes.ProjectController.getMyEnrolledProjects(j, sort)">@j</a></li>
                                }
                            }
                        }
                        </ul>
                    }
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#!" class="modal-close waves-effect waves-green btn-flat">
                        Cancel</a>
                </div>
            </div>

            <div id="searchPageModal" class="modal">
                <div class="modal-content">
                    <h6>Select the page number you want to jump to</h6>
                    <div class="card z-depth-0">

                    @for(i <- (0) to ((((total - 1)/(pageLimit) + 1) - 1)/10)) {
                        <ul class="pagination center-align">
                        @for(j <- (i * 10 + 1) to (i * 10 + 10)) {
                            @if(j <= ((total - 1)/(pageLimit) + 1)) {
                                @if(j != pageNum) {
                                    <li class="waves-effect grey lighten-3"><a href='#!' onclick="jumpToPage(@j, 'id', '@searchBody')">@j</a></li>
                                }else{
                                    <li class="waves-effect active"><a href="#!" onclick="jumpToPage(@j, 'id', '@searchBody')">@j</a></li>
                                }
                            }
                        }
                        </ul>
                    }
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#!" class="modal-close waves-effect waves-green btn-flat">
                        Cancel</a>
                </div>
            </div>

        </div>
    </div>
}

